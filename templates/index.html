<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arbitrage Opportunities</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 0;
            background-color: #f9f9f9;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .filter-box {
            margin-bottom: 20px;
            text-align: center;
        }
        .filter-box input {
            padding: 8px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .filter-box button {
            padding: 8px 16px;
            font-size: 16px;
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .filter-box button:hover {
            background-color: #0056b3;
        }
        ul {
            list-style-type: none;
            padding: 0;
        }
        li {
            padding: 15px;
            background-color: #fff;
            border: 1px solid #ddd;
            margin-bottom: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .match {
            font-size: 1.2em;
            font-weight: bold;
            color: #007bff;
        }
        .sport {
            font-style: italic;
            color: #555;
        }
        .event-time {
            color: #28a745;
            margin: 5px 0;
        }
        .odds {
            margin-top: 10px;
        }
        .odds a {
            color: #dc3545;
            text-decoration: none;
            font-weight: bold;
        }
        .odds a:hover {
            text-decoration: underline;
        }
        .arbitrage-percentage {
            font-weight: bold;
            color: #ff5722;
            margin-top: 10px;
        }
        .potential-profit {
            font-weight: bold;
            color: #28a745;
            margin-top: 10px;
        }
        .stake-input {
            margin-top: 10px;
        }
        .stake-input input {
            padding: 8px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .stake-input button {
            padding: 8px 16px;
            font-size: 16px;
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .stake-input button:hover {
            background-color: #0056b3;
        }
        .no-opportunities {
            text-align: center;
            color: #dc3545;
            font-weight: bold;
        }
        @media (max-width: 768px) {
            body {
                margin: 10px;
            }
            li {
                padding: 10px;
            }
            .match {
                font-size: 1.1em;
            }
        }
    </style>
</head>
<body>
    <h1>Arbitrage Opportunities</h1>
    <div class="filter-box">
        <label for="arbitrage-filter">Show opportunities with arbitrage % â‰¥ </label>
        <input type="number" id="arbitrage-filter" placeholder="e.g., 10" min="0" step="0.1">
        <button onclick="applyFilter()">Apply Filter</button>
    </div>
    <ul id="opportunities-list">
        {% for opportunity in opportunities %}
        <li class="opportunity" data-arbitrage="{{ opportunity.arbitrage_percentage }}">
            <div class="match">{{ opportunity.match }}</div>
            <div class="sport">{{ opportunity.sport }}</div>
            <div class="event-time">Event Time: {{ opportunity.event_time }}</div>
            <div class="odds">
                <strong>Home:</strong> {{ opportunity.home_site }} - Odds: {{ opportunity.home_odds }} 
                <a href="{{ opportunity.home_url }}" target="_blank" rel="noopener noreferrer">Place Bet</a>
            </div>
            <div class="odds">
                <strong>Away:</strong> {{ opportunity.away_site }} - Odds: {{ opportunity.away_odds }} 
                <a href="{{ opportunity.away_url }}" target="_blank" rel="noopener noreferrer">Place Bet</a>
            </div>
            <div class="arbitrage-percentage">
                Arbitrage Percentage: {{ opportunity.arbitrage_percentage }}%
            </div>
            <div class="potential-profit">
                Potential Profit (for $100 stake): ${{ (opportunity.arbitrage_percentage / 100 * 100)|round(2) }}
            </div>
            <div class="stake-input">
                <label for="stake-{{ loop.index }}">Enter Total Stake ($):</label>
                <input type="number" id="stake-{{ loop.index }}" placeholder="100">
                <button onclick="calculateStakes({{ loop.index }}, {{ opportunity.home_odds }}, {{ opportunity.away_odds }})">Calculate Stakes</button>
                <p id="stake-result-{{ loop.index }}"></p>
            </div>
        </li>
        {% else %}
        <li class="no-opportunities">No arbitrage opportunities found.</li>
        {% endfor %}
    </ul>

    <script>
        // Apply filter based on arbitrage percentage
        function applyFilter() {
            const filterValue = parseFloat(document.getElementById("arbitrage-filter").value);
            const opportunities = document.querySelectorAll(".opportunity");
            let visibleCount = 0;

            opportunities.forEach(opp => {
                const arbitrage = parseFloat(opp.getAttribute("data-arbitrage"));
                if (arbitrage >= filterValue) {
                    opp.style.display = "block";
                    visibleCount++;
                } else {
                    opp.style.display = "none";
                }
            });

            // Show message if no opportunities match the filter
            const noOpportunitiesMessage = document.querySelector(".no-opportunities");
            if (visibleCount === 0) {
                if (!noOpportunitiesMessage) {
                    const ul = document.getElementById("opportunities-list");
                    ul.innerHTML = '<li class="no-opportunities">No opportunities found with an arbitrage percentage of ' + filterValue + '% or higher.</li>';
                }
            } else {
                if (noOpportunitiesMessage) {
                    noOpportunitiesMessage.remove();
                }
            }
        }

        // Calculate stakes for each opportunity
        function calculateStakes(index, homeOdds, awayOdds) {
            const stake = parseFloat(document.getElementById(`stake-${index}`).value);
            if (isNaN(stake) || stake <= 0) {
                document.getElementById(`stake-result-${index}`).innerText = "Please enter a valid stake.";
                return;
            }

            const impliedProbHome = 1 / homeOdds;
            const impliedProbAway = 1 / awayOdds;
            const totalImpliedProb = impliedProbHome + impliedProbAway;

            const stakeHome = (stake * impliedProbHome) / totalImpliedProb;
            const stakeAway = (stake * impliedProbAway) / totalImpliedProb;

            document.getElementById(`stake-result-${index}`).innerText = 
                `Stake on Home: $${stakeHome.toFixed(2)} | Stake on Away: $${stakeAway.toFixed(2)}`;
        }
    </script>
</body>
</html>